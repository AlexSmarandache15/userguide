<project name="userguide" default="build-all">

	<!-- Constants -->
	<property name="c-xmx">-Xmx2384m</property>

	<condition property="dita.executable" value="dita.bat">
		<os family="windows" />
	</condition>
	<property name="dita.executable" value="dita" />

	<!-- 
	==================================
	Webhelp 
	==================================	
	-->
	<target name="build-webhelp-public">
		<antcall target="build-webhelp-common">
			<param name="p-type">-public</param>
		</antcall>
	</target>

	<target name="build-webhelp-private">
		<antcall target="build-webhelp-common">
			<param name="p-type">-private</param>
		</antcall>
	</target>

	<target name="build-webhelp-common">
		<antcall target="build-single">
			<param name="p-product" value="author-sa" />
			<param name="p-format" value="webhelp-responsive" />
			<param name="p-type" value="-public" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="author-eclipse" />
			<param name="p-format" value="webhelp-responsive" />
			<param name="p-type" value="-public" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="developer-sa" />
			<param name="p-format" value="webhelp-responsive" />
			<param name="p-type" value="-public" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="developer-eclipse" />
			<param name="p-format" value="webhelp-responsive" />
			<param name="p-type" value="-public" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="editor-sa" />
			<param name="p-format" value="webhelp-responsive" />
			<param name="p-type" value="-public" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="editor-eclipse" />
			<param name="p-format" value="webhelp-responsive" />
			<param name="p-type" value="-public" />
		</antcall>

		
		<antcall target="build-single">
			<param name="p-product" value="content-fusion" />
			<param name="p-format" value="webhelp-responsive" />
			<param name="p-type" value="-public" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="webauthor" />
			<param name="p-format" value="webhelp-responsive" />
			<param name="p-type" value="-public" />
		</antcall>
		<!-- TODO - Uncomment after we commit the opt. 
		<antcall target="build-single">
			<param name="p-product" value="webauthor-customization" />
			<param name="p-format" value="webhelp-responsive" />
			<param name="p-type" value="-public" />
		</antcall>
		-->

		<antcall target="build-single">
			<param name="p-product" value="chemistry" />
			<param name="p-format" value="webhelp-responsive" />
			<param name="p-type" value="-public" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="dcpp" />
			<param name="p-format" value="webhelp-responsive" />
			<param name="p-type" value="-public" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="webhelp-classic" />
			<param name="p-format" value="webhelp-responsive" />
			<param name="p-type" value="-public" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="webhelp-responsive" />
			<param name="p-format" value="webhelp-responsive" />
			<param name="p-type" value="-public" />
		</antcall>
	</target>

	<!-- 
		==================================
		PDF 
		==================================	
		-->
	<target name="build-pdf">

		<antcall target="build-single">
			<param name="p-product" value="author-sa" />
			<param name="p-format" value="pdf-css" />
			<param name="p-type" value="" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="author-eclipse" />
			<param name="p-format" value="pdf-css" />
			<param name="p-type" value="" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="developer-sa" />
			<param name="p-format" value="pdf-css" />
			<param name="p-type" value="" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="developer-eclipse" />
			<param name="p-format" value="pdf-css" />
			<param name="p-type" value="" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="editor-sa" />
			<param name="p-format" value="pdf-css" />
			<param name="p-type" value="" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="editor-eclipse" />
			<param name="p-format" value="pdf-css" />
			<param name="p-type" value="" />
		</antcall>

		<antcall target="build-single">
			<param name="p-product" value="chemistry" />
			<param name="p-format" value="pdf-css" />
			<param name="p-type" value="" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="dcpp" />
			<param name="p-format" value="pdf-css" />
			<param name="p-type" value="" />
		</antcall>

	</target>

	<!-- 
		==================================
		Eclipse Help 
		==================================	
		-->
	<target name="build-eclipsehelp">
		<antcall target="build-single">
			<param name="p-product" value="author-eclipse" />
			<param name="p-format" value="eclipsehelp" />
			<param name="p-type" value="" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="developer-eclipse" />
			<param name="p-format" value="eclipsehelp" />
			<param name="p-type" value="" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="editor-eclipse" />
			<param name="p-format" value="eclipsehelp" />
			<param name="p-type" value="" />
		</antcall>
	</target>
	<!-- 
		==================================
		Java Help 
		==================================	
		-->
	<target name="build-javahelp">
		<antcall target="build-single">
			<param name="p-product" value="author-sa" />
			<param name="p-format" value="javahelp" />
			<param name="p-type" value="" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="developer-sa" />
			<param name="p-format" value="javahelp" />
			<param name="p-type" value="" />
		</antcall>
		<antcall target="build-single">
			<param name="p-product" value="editor-sa" />
			<param name="p-format" value="javahelp" />
			<param name="p-type" value="" />
		</antcall>
	</target>

	
	<!-- 
		==================================
		All deliverables.
		build-webhelp-public, 
		==================================	
		-->
	<target name="build-all" depends="build-pdf, build-eclipsehelp, build-eclipsehelp, build-javahelp">
		<echo>Build All</echo>
	</target>

	<!-- 
		==================================
		A single deliverable for a single product.
		==================================	
		-->
	<target name="build-single">

		<echo>--------------------------------</echo>
		<echo>Build single target: ${p-product} / ${p-format} ${p-type}</echo>

		<property name="p-output">${project.build.directory}/output/${p-format}${p-type}/${p-product}</property>
		<property name="p-temp">${project.build.directory}/temp/${p-format}${p-type}/${p-product}</property>

		<property name="p-ditaval">${basedir}/DITA/ditaval/${p-product}.ditaval</property>
		<property name="p-template">${basedir}/publishing/publishing-template/${p-product}${p-type}.opt</property>

		<delete dir="${p-output}" />
		<mkdir dir="${p-output}" />

		<echo>Template: ${p-template} </echo>
		<echo>Format  : ${p-format} </echo>
		<echo>DITA OT : ${dita-ot-dir} </echo>
		<echo>DITA val: ${p-ditaval} </echo>
		<echo>Temp    : ${p-temp} </echo>
		<echo>Output  : ${p-output} </echo>
		<exec failifexecutionfails="true" failonerror="true" executable="${dita-ot-dir}/bin/${dita.executable}">

			<!-- General parameters -->
			<arg value="--format=${p-format}" />
			<arg value="--output=${p-output}" />
			<arg value="--temp=${p-temp}" />
			<arg value="--verbose" />
			<arg value="--input=${basedir}/DITA/UserManual.ditamap" />
			<arg value="-filter=${p-ditaval}" />

			<arg value="-Dhttp.proxySet=true" />
			<arg value="-Dhttp.proxyHost=proxy.sync.ro" />
			<arg value="-Dhttp.proxyPort=3128" />

			<arg value="-Dhttps.proxySet=true" />
			<arg value="-Dhttps.proxyHost=proxy.sync.ro" />
			<arg value="-Dhttps.proxyPort=3128" />

			<arg value="-DbaseJVMArgLine=${c-xmx}" />

			<!-- Relevant only for pdf -->
			<arg value="-Dpdf.publishing.template=${p-template}" />
			<arg value="-DoutputFile=${p-output}/${p-product}.pdf" />

			<!-- Relevant only for webhelp -->
			<arg value="-Dwebhelp.publishing.template=${p-template}" />
			<arg value="-Deditlink.remote.ditamap.url=github://getFileContent/oxygenxml/userguide-private/dev/DITA/UserManual.ditamap" />
			<arg value="-Deditlink.web.author.url=https://www.oxygenxml.com/webapp-demo-aws/" />

			<!-- Relevant only for eclipsehelp -->
			<arg value="-Dargs.eclipsehelp.jar.name=${p-product}-help.jar" />

		</exec>

		<!-- Relevant for the javahelp -->
		<move file="${p-output}/UserManual.jar" tofile="${p-output}/${p-product}-help.jar" failonerror="false" />

	</target>


</project>